/* =========================================================
   NEON TECH — global theme tokens, components, utilities
   (original content preserved + drawer polish)
   ========================================================= */

/* --- Tokens --- */
:root{
  --page-bg-1:#0b1220;
  --page-bg-2:#0f172a;
  --glow-1:#243b55;
  --glow-2:#1b3a6b;

  --accent-ink:#9ecbff;
  --text: var(--accent-ink);
  --muted: var(--accent-ink);

  --card-bg:rgba(255,255,255,.045);
  --card-border:rgba(255,255,255,.10);
  --hair:rgba(255,255,255,.08);

  --thead-bg:rgba(255,255,255,.06);
  --thead-fg: var(--accent-ink);

  --table-head-bg: var(--thead-bg);
  --table-head-fg: var(--thead-fg);

  --plotly-grid: rgba(158,203,255,.11);

  --scroll-track: transparent;
  --scroll-thumb: color-mix(in oklab, var(--accent-ink) 58%, transparent);
  --scroll-thumb-hover: color-mix(in oklab, var(--accent-ink) 82%, transparent);
  --scroll-border: rgba(255,255,255,.22);

  /* Drawer polish */
  --drawer-bleed: 18px;   /* how far the glass should extend left for month divider */
}

/* --- Page background --- */
html.theme-dark, body.theme-dark {
  background:
    radial-gradient(1200px 700px at -10% -10%, var(--glow-1) 0%, transparent 45%),
    radial-gradient(900px 600px at 110% 0%, var(--glow-2) 0%, transparent 40%),
    linear-gradient(180deg, var(--page-bg-2) 0%, var(--page-bg-1) 100%) !important;
  color: var(--text);
}

/* --- Navbar --- */
.navbar {
  background: var(--card-bg) !important;
  border-bottom: 1px solid var(--card-border) !important;
  backdrop-filter: saturate(120%) blur(6px);
}
.navbar, .navbar .navbar-brand, .navbar .nav-link, .navbar .navbar-text {
  color: var(--text) !important;
}
.navbar .nav-link.active, .navbar .nav-link:hover { color: #ffffff !important; }

/* --- Cards, panels, modals, offcanvas --- */
.card, .stat-card, .panel, .list-group, .offcanvas, .modal-content {
  background: var(--card-bg) !important;
  border: 1px solid var(--card-border) !important;
  color: var(--text);
  box-shadow:
    0 12px 28px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.05);
  border-radius: 16px;
  backdrop-filter: saturate(120%) blur(4px);
}
.card .card-header,
.stat-card .card-header,
.panel .card-header{
  background: var(--thead-bg) !important;
  color: var(--text) !important;
  border-bottom: 1px solid var(--hair) !important;
  font-weight: 700;
  letter-spacing: .2px;
}

/* --- Forms & buttons --- */
.form-control, .form-select, .input-group-text, .btn-outline-secondary, .btn-outline-light {
  background: rgba(255,255,255,.06) !important;
  border-color: var(--card-border) !important;
  color: var(--text) !important;
}
.form-control::placeholder { color: color-mix(in oklab, var(--accent-ink) 70%, transparent); }
.btn-outline-light { color: var(--text) !important; }
.btn-primary { background: #2563eb; border-color: #2563eb; }

/* --- Table shell --- */
.table-responsive{
  border:1px solid var(--card-border);
  border-radius:14px;
  background:var(--card-bg);
  box-shadow:0 8px 24px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.04);
  overflow:auto;
  position: relative;
  scrollbar-gutter: stable both-edges;
  box-sizing: border-box;
}

/* --- Table colors --- */
.theme-dark .table{
  --bs-table-bg: transparent;
  --bs-table-color: var(--text);
  --bs-table-border-color: var(--hair);
  --bs-table-striped-bg: rgba(255,255,255,.02);
  --bs-table-striped-color: var(--text);
  --bs-table-hover-bg: rgba(255,255,255,.05);
  --bs-table-hover-color: var(--text);
}
.theme-dark .table > :not(caption) > * > *{
  background-color: transparent !important;
  box-shadow: none !important;
}

/* --- Floating tables (unified shell used across pages) --- */
.table-floating,
.table-floating .table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  color:var(--text);
  background:transparent;
}
.table-floating > :not(caption) > thead > tr > th,
.table-floating .table > :not(caption) > thead > tr > th{
  border-bottom:1px solid var(--hair);
  font-weight:700; letter-spacing:.2px;
}
.table-floating > :not(caption) > tbody > tr > td,
.table-floating .table > :not(caption) > tbody > tr > td{
  border-top:1px solid var(--hair);
  vertical-align:middle;
}
.table-floating > :not(caption) > tbody > tr:nth-child(odd),
.table-floating .table > :not(caption) > tbody > tr:nth-child(odd){
  background:rgba(255,255,255,.015);
}
.table-floating > :not(caption) > tbody > tr:hover,
.table-floating .table > :not(caption) > tbody > tr:hover{
  background:rgba(255,255,255,.05);
}

/* --- True frosted sticky table heads (global) --- */
.table thead th,
.table thead td{
  background: var(--thead-bg) !important;
  color: var(--table-head-fg, var(--text)) !important;
  border-bottom:1px solid var(--hair) !important;
  white-space: nowrap;       /* prevent weird vertical headers */
  word-break: keep-all;
}
.table thead th:first-child { border-top-left-radius: 12px; }
.table thead th:last-child  { border-top-right-radius: 12px; }

.table-responsive thead{
  position: sticky;
  top: 0;
  z-index: 4;
}
.table thead th{
  backdrop-filter: saturate(120%) blur(8px);
  -webkit-backdrop-filter: saturate(120%) blur(8px);
  background:
    linear-gradient(
      180deg,
      color-mix(in oklab, var(--thead-bg) 92%, transparent) 0%,
      color-mix(in oklab, var(--thead-bg) 78%, transparent) 100%
    ) !important;
  border-bottom: 1px solid var(--hair) !important;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.06),
    0 10px 18px rgba(2, 6, 23, .25);
  will-change: backdrop-filter;
  padding: .70rem .95rem;
  font-weight: 700;
  letter-spacing: .2px;
}

/* --- Utilities --- */
canvas { background: transparent !important; }
.muted { color: var(--muted) !important; }
.mono { font-variant-numeric: tabular-nums; }
.tx-neg { color:#c0392b; font-weight:600; }
.tx-pos { color:#1e7e34; font-weight:600; }

/* --- Global scrollbars --- */

/* Firefox – page */
html.theme-dark, body.theme-dark {
  scrollbar-width: thin;
  scrollbar-color: var(--scroll-thumb) var(--scroll-track);
}
/* Firefox – common inner scrollers */
.table-responsive, .offcanvas, .offcanvas-body, .modal, .modal-body {
  scrollbar-width: thin;
  scrollbar-color: var(--scroll-thumb) var(--scroll-track);
}

/* WebKit – page */
html.theme-dark::-webkit-scrollbar,
body.theme-dark::-webkit-scrollbar{ width:12px; height:12px; }
html.theme-dark::-webkit-scrollbar-track,
body.theme-dark::-webkit-scrollbar-track{ background: var(--scroll-track); }
html.theme-dark::-webkit-scrollbar-thumb,
body.theme-dark::-webkit-scrollbar-thumb{
  background: var(--scroll-thumb);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow:
    0 2px 8px rgba(0,0,0,.35),
    inset 0 0 0 1px var(--scroll-border);
}
html.theme-dark::-webkit-scrollbar-thumb:hover,
body.theme-dark::-webkit-scrollbar-thumb:hover{ background: var(--scroll-thumb-hover); }
html.theme-dark::-webkit-scrollbar-corner,
body.theme-dark::-webkit-scrollbar-corner{ background: transparent; }

/* WebKit – inner scrollers */
.table-responsive::-webkit-scrollbar,
.offcanvas::-webkit-scrollbar,
.offcanvas-body::-webkit-scrollbar,
.modal::-webkit-scrollbar,
.modal-body::-webkit-scrollbar{ width:12px; height:12px; }
.table-responsive::-webkit-scrollbar-track,
.offcanvas::-webkit-scrollbar-track,
.offcanvas-body::-webkit-scrollbar-track,
.modal::-webkit-scrollbar-track,
.modal-body::-webkit-scrollbar-track{ background: var(--scroll-track); }
.table-responsive::-webkit-scrollbar-thumb,
.offcanvas::-webkit-scrollbar-thumb,
.offcanvas-body::-webkit-scrollbar-thumb,
.modal::-webkit-scrollbar-thumb,
.modal-body::-webkit-scrollbar-thumb{
  background: var(--scroll-thumb);
  border-radius: 999px;
  border: 3px solid transparent;
  background-clip: padding-box;
  box-shadow:
    0 2px 8px rgba(0,0,0,.35),
    inset 0 0 0 1px var(--scroll-border);
}
.table-responsive::-webkit-scrollbar-thumb:hover,
.offcanvas::-webkit-scrollbar-thumb:hover,
.offcanvas-body::-webkit-scrollbar-thumb:hover,
.modal::-webkit-scrollbar-thumb:hover,
.modal-body::-webkit-scrollbar-thumb:hover{ background: var(--scroll-thumb-hover); }
.table-responsive::-webkit-scrollbar-corner,
.offcanvas::-webkit-scrollbar-corner,
.offcanvas-body::-webkit-scrollbar-corner,
.modal::-webkit-scrollbar-corner,
.modal-body::-webkit-scrollbar-corner{ background: transparent; }

/* --- Goals page left-align only (kept) --- */
body[data-route="/goals"] .table th,
body[data-route="/goals"] .table td{ text-align:left !important; }
body[data-route="/goals"] .table .text-end,
body[data-route="/goals"] .table .text-center,
body[data-route="/goals"] .table [style*="text-align: right"],
body[data-route="/goals"] .table [style*="text-align:right"],
body[data-route="/goals"] .table [style*="text-align: center"],
body[data-route="/goals"] .table [style*="text-align:center"]{ text-align:left !important; }
body[data-route="/goals"] .table .form-control,
body[data-route="/goals"] .table .input-group .form-control{ text-align:left !important; }

/* =========================================================
   Drawer (global, glassy, sticky)
   ========================================================= */

/* Keyword pill with inner close button */
.pill {
  display: inline-flex;
  align-items: center;
  gap: .4rem;
  padding: .28rem .6rem .28rem .6rem;
  border: 1px solid var(--bs-border-color, rgba(255,255,255,.15));
  background: rgba(255,255,255,.06);
  border-radius: 999px;
  line-height: 1.1;
  font-size: .9rem;
  white-space: nowrap;
}

.pill .pill-text {
  max-width: 14rem;            /* long keywords don’t blow up the row */
  overflow: hidden;
  text-overflow: ellipsis;
}

.pill .pill-close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  border: 0;
  border-radius: 999px;
  background: transparent;
  padding: 0;
  cursor: pointer;
  opacity: .65;
  line-height: 1;
  font-weight: 700;
  font-size: 12px;             /* size of the “×” */
}
.pill .pill-close:hover { opacity: 1; }
.pill .pill-close:focus { outline: none; box-shadow: 0 0 0 2px rgba(255,255,255,.15); }


/* Backdrop blur */
.offcanvas-backdrop.show{
  background: rgba(8,12,20,.34) !important;
  -webkit-backdrop-filter: blur(16px) saturate(140%);
  backdrop-filter: blur(16px) saturate(140%);
}

/* Shell */
.manage-drawer.offcanvas{
  background: var(--card-bg) !important;
  border-left: 1px solid var(--card-border) !important;
  color: var(--text);
  box-shadow:
    0 22px 48px rgba(0,0,0,.50),
    inset 0 1px 0 rgba(255,255,255,.05);
}

/* Header: frosted + sticky (match navbar) */
.manage-drawer .offcanvas-header{
  position: sticky;
  top: 0;
  z-index: 5;
  background:
    linear-gradient(
      180deg,
      color-mix(in oklab, var(--thead-bg) 92%, transparent) 0%,
      color-mix(in oklab, var(--thead-bg) 78%, transparent) 100%
    ) !important;
  -webkit-backdrop-filter: saturate(130%) blur(12px);
  backdrop-filter: saturate(130%) blur(12px);
  border-bottom: 1px solid var(--hair) !important;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.06),
    0 10px 18px rgba(2,6,23,.25);
}
.manage-drawer .offcanvas-title{
  font-weight: 800;
  letter-spacing: .2px;
  line-height: 1.1;
  color: var(--text);
}

/* Drawer tabs (no white) */
.manage-drawer .drawer-tabs{
  display:flex; gap:.5rem;
  border-bottom:1px solid var(--hair);
  margin-bottom:.6rem;
}
.manage-drawer .drawer-tab{
  padding:.35rem .65rem;
  border-radius:.6rem .6rem 0 0;
  text-decoration:none;
  color: var(--text);
  background: transparent;
  border:1px solid transparent;
}
.manage-drawer .drawer-tab:hover{
  background: rgba(255,255,255,.06);
  border-color: var(--hair);
}
.manage-drawer .drawer-tab.active{
  background:
    linear-gradient(
      180deg,
      color-mix(in oklab, var(--thead-bg) 92%, transparent) 0%,
      color-mix(in oklab, var(--thead-bg) 78%, transparent) 100%
    );
  border:1px solid var(--hair);
  border-bottom-color: transparent;
}

/* Children: floating panel, linky, no pills/bullets/white */
.manage-drawer .children-panel{
  position: relative;
  margin: .35rem 0 .75rem;
  padding: .65rem .85rem;
  border: 1px solid var(--card-border);
  border-radius: 12px;
  background:
    linear-gradient(
      135deg,
      color-mix(in oklab, var(--card-bg) 80%, transparent) 0%,
      color-mix(in oklab, var(--card-bg) 60%, transparent) 100%
    );
  -webkit-backdrop-filter: saturate(120%) blur(8px);
  backdrop-filter: saturate(120%) blur(8px);
  box-shadow:
    0 10px 22px rgba(0,0,0,.35),
    inset 0 1px 0 rgba(255,255,255,.05);
  overflow: hidden;
}
.manage-drawer .children-links{
  display:flex; flex-wrap:wrap; gap:.65rem 1.25rem;
  margin:0; padding:0; list-style:none;
}
.manage-drawer .children-links a{
  text-decoration:none;
  color: var(--accent-ink);
  font-weight: 700;
  letter-spacing:.2px;
  outline: none;
  border: 1px solid transparent;     /* no visible outline until hover */
  border-radius: 8px;
  padding: .1rem .25rem;
}
.manage-drawer .children-links a:hover{
  background: rgba(255,255,255,.06);
  border-color: var(--hair);
}

/* Drawer table — mirror Transactions look */
.manage-drawer #drawer-tx{
  table-layout: auto;                 /* prevent forced tiny columns */
  width:100%;
  border-collapse: separate;
  border-spacing:0;
}
.manage-drawer #drawer-tx thead th{
  white-space: nowrap;
  word-break: keep-all;
}
.manage-drawer #drawer-tx th,
.manage-drawer #drawer-tx td{
  padding: 18px 22px;
  vertical-align: top;
  line-height: 1.35;
}
.manage-drawer #drawer-tx tbody tr{
  border-top: 1px solid var(--hair);
}
.manage-drawer #drawer-tx tbody tr:hover{
  background: rgba(255,255,255,.05);
}

/* Column sizing to match the main Transactions table */
.manage-drawer #drawer-tx thead th:nth-child(1),
.manage-drawer #drawer-tx tbody td:nth-child(1){ width:120px; }
.manage-drawer #drawer-tx thead th:nth-child(3),
.manage-drawer #drawer-tx tbody td:nth-child(3){ width:140px; text-align:right; }
.manage-drawer #drawer-tx thead th:nth-child(4),
.manage-drawer #drawer-tx tbody td:nth-child(4){ width:260px; }

/* Allow only Description to wrap to multiple lines */
.manage-drawer #drawer-tx tbody td:nth-child(2){
  white-space: normal;
  word-break: break-word;
}

/* Month divider — sticky, glassy, with left bleed flush to rail */
.manage-drawer #drawer-tx .month-divider{ background: transparent !important; }
.manage-drawer #drawer-tx .month-divider > td{
  position: sticky;
  top: calc(0px + var(--thead-sticky-offset, 40px));
  z-index: 3;
  padding: 10px 22px;
  font-weight: 800;
  letter-spacing:.2px;
  backdrop-filter: saturate(120%) blur(10px);
  -webkit-backdrop-filter: saturate(120%) blur(10px);
  background:
    linear-gradient(
      180deg,
      color-mix(in oklab, var(--thead-bg) 92%, transparent) 0%,
      color-mix(in oklab, var(--thead-bg) 78%, transparent) 100%
    ) !important;
  border-top: 1px solid var(--hair);
  border-bottom: 1px solid var(--hair);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.06),
    0 8px 14px rgba(2,6,23,.22);
}
/* create the left bleed so the tint lines up with the drawer rail */
.manage-drawer #drawer-tx .month-divider > td::before{
  content:"";
  position:absolute;
  left: calc(-1 * var(--drawer-bleed));
  right: 0;
  top: 0; bottom: 0;
  border-top-left-radius: 12px;
  background:
    linear-gradient(
      180deg,
      color-mix(in oklab, var(--thead-bg) 92%, transparent) 0%,
      color-mix(in oklab, var(--thead-bg) 78%, transparent) 100%
    );
  z-index:-1;
}

/* Drawer scroller styling */
.manage-drawer .offcanvas-body{ padding-top: .25rem; }
.manage-drawer .tx-scroll{ background: transparent; isolation: isolate; }

/* Close button polish on dark glass */
.manage-drawer .btn-close{
  filter: invert(1) grayscale(1) contrast(90%);
  opacity: .85;
}
.manage-drawer .btn-close:hover{ opacity: 1; }

/* =========================================================
   Pill refinements (drawer keyword chips)
   ========================================================= */
.manage-drawer .pill{
  flex: none;                     /* don’t collapse in tight rows */
  min-height: 28px;               /* comfortable hit target */
  transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.manage-drawer .pill:hover{
  background: rgba(255,255,255,.10);
  border-color: var(--hair);
  box-shadow: 0 2px 10px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.06);
}
.manage-drawer .pill:focus-visible{
  outline: none;
  box-shadow: 0 0 0 2px rgba(255,255,255,.12), 0 0 0 4px rgba(37,99,235,.35);
}

/* selected/active state (e.g., when filtering by a keyword) */
.manage-drawer .pill[aria-pressed="true"],
.manage-drawer .pill.is-active{
  background: color-mix(in oklab, var(--accent-ink) 18%, transparent);
  border-color: color-mix(in oklab, var(--accent-ink) 38%, transparent);
}

/* better truncation + tooltip affordance */
.manage-drawer .pill .pill-text{
  max-width: 18rem;               /* a bit more room inside the drawer */
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

/* close button: larger tap target + subtle hover plate */
.manage-drawer .pill .pill-close{
  width: 20px;
  height: 20px;
  margin-left: .1rem;
  border-radius: 6px;             /* less circular = clearer affordance */
}
.manage-drawer .pill .pill-close:hover{
  background: rgba(255,255,255,.12);
}
.manage-drawer .pill .pill-close:focus-visible{
  outline: none;
  box-shadow: 0 0 0 2px rgba(255,255,255,.14);
}

/* row container for chips */
.manage-drawer .pill-row{
  display: flex;
  flex-wrap: wrap;
  gap: .45rem .55rem;
  align-items: center;
}

/* “deleting” micro-state while JS removes the chip */
@media (prefers-reduced-motion: no-preference){
  .manage-drawer .pill.is-removing{
    transform: scale(.98);
    opacity: .4;
    filter: saturate(.6);
    transition: transform .12s ease, opacity .12s ease, filter .12s ease;
  }
}
