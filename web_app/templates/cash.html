{% extends "layout.html" %}
{% block content %}
<div class="container my-4" style="max-width: 900px;">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="m-0 text-secondary fw-semibold">Cash</h2>
  </div>

  {# ---- Flash messages (supports namespacing like "cash:success" and generic) ---- #}
  {% set flashes = get_flashed_messages(with_categories=true) %}
  {% if flashes %}
    <div class="mb-3">
      {% for raw_cat, message in flashes %}
        {% set parts = raw_cat.split(':', 1) if raw_cat else [] %}
        {% set base  = parts[1] if parts|length == 2 else (raw_cat or 'info') %}
        {% set bs = 'success' if base=='success'
                   else 'warning' if base=='warning'
                   else 'danger'  if base in ['danger','error']
                   else 'info' %}
        <div class="alert alert-{{ bs }} mb-2 alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="row g-3">
    <!-- Add Income -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header border-0">
          <h5 class="m-0">➕ Add Income</h5>
        </div>
        <div class="card-body pt-3">
          <form method="POST" action="{{ url_for('submit_income') }}" autocomplete="off" novalidate>
            <div class="mb-3">
              <label for="inc_date" class="form-label">Date</label>
              <input type="date" class="form-control" id="inc_date" name="date" required>
            </div>
            <div class="mb-3">
              <label for="inc_amount" class="form-label">Amount</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" inputmode="decimal" class="form-control" id="inc_amount" name="amount" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="inc_description" class="form-label">Description</label>
              <input type="text" class="form-control" id="inc_description" name="description" placeholder="e.g. MOBILE DEPOSIT • ACME" required>
              <div class="form-text">Use good keywords here — they'll drive categorization.</div>
            </div>
            <div class="mb-3">
              <label for="inc_person" class="form-label">Cash From</label>
              <select class="form-select" id="inc_person" name="person" required>
                <option value="">— Select —</option>
                <option value="JL">JL</option>
                <option value="Rachel">Rachel</option>
              </select>
            </div>
            <button type="submit" class="btn btn-success w-100">Submit Income</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Expense -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header border-0">
          <h5 class="m-0">➖ Add Expense</h5>
        </div>
        <div class="card-body pt-3">
          <form method="POST" action="{{ url_for('submit_expense') }}" autocomplete="off" novalidate>
            <div class="mb-3">
              <label for="exp_date" class="form-label">Date</label>
              <input type="date" class="form-control" id="exp_date" name="date" required>
            </div>
            <div class="mb-3">
              <label for="exp_amount" class="form-label">Amount</label>
              <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" step="0.01" inputmode="decimal" class="form-control" id="exp_amount" name="amount" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="exp_description" class="form-label">Description</label>
              <input type="text" class="form-control" id="exp_description" name="description" placeholder="e.g. PUBLIX #123 ORLANDO FL" required>
              <div class="form-text">Keywords in the description will auto-categorize this.</div>
            </div>

            {# No category/subcategory fields — categorization is keyword-driven #}
            <button type="submit" class="btn btn-danger w-100">Save Expense</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
