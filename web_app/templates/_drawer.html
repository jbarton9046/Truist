<!-- Right-side Category Manager Drawer -->
<div class="offcanvas offcanvas-end manage-drawer" tabindex="-1" id="dashCategoryManager" aria-labelledby="dashCategoryManagerLabel" style="width:480px;">
  <div class="offcanvas-header">
    <div class="d-flex flex-column gap-1">
      <h5 class="offcanvas-title" id="dashCategoryManagerLabel">
        <nav id="drawer-breadcrumb" class="drawer-breadcrumb"></nav>
      </h5>

      <!-- Header controls: Month + Total -->
      <div class="small d-flex align-items-center flex-wrap gap-2">
        <span>Month:</span>

        <!-- Hidden native select (state source for JS) -->
        <select id="drawer-months" class="d-none"></select>

        <!-- Button that opens the FULL overlay selector -->
        <button id="drawer-months-open" class="glass-btn" type="button">
          <span id="drawer-months-label">Latest month</span>
          <svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="M4 6l4 4 4-4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </button>

        <span class="mx-1">•</span>
        <span>Total:</span>
        <span id="drawer-total" class="fw-semibold">—</span>
      </div>
    </div>

    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <style>
    /* ---------- Base layout ---------- */
    .drawer-breadcrumb{ display:flex; gap:.4rem; flex-wrap:wrap; align-items:center; }
    .drawer-breadcrumb .sep{ opacity:.6; }
    .drawer-tabbar{ display:flex; gap:.4rem; border-bottom:1px solid rgba(255,255,255,.08); margin:.25rem 0 .75rem; }
    .drawer-tab{ padding:.35rem .65rem; border-radius:.5rem .5rem 0 0; text-decoration:none; color:inherit; }
    .drawer-tab.active{ background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); border-bottom-color:transparent; }
    .drawer-pane{ display:none; }
    .mono{ font-variant-numeric: tabular-nums; }
    .tx-neg{ color:#d36b6b; } .tx-pos{ color:#6bd39c; }

    /* ---------- Pills: colors are set from the “Filter keywords…” field by JS ---------- */
    #dashCategoryManager{
      --pill-bg: rgba(80,150,255,.08);            /* fallback if field not found */
      --pill-bg-hover: rgba(80,150,255,.14);
      --pill-border: rgba(80,150,255,.35);
      --pill-border-hover: rgba(80,150,255,.50);
      --pill-fg: #7fb2ff;
      --pill-fg-hover: #a9caff;
    }
    #dashCategoryManager .pill{
      display:inline-flex; align-items:center; gap:.4rem; line-height:1;
      padding:.35rem .75rem; border-radius:999px;
      background:var(--pill-bg); color:var(--pill-fg); border:1px solid var(--pill-border);
      text-decoration:none; cursor:pointer; transition:background .15s, border-color .15s, color .15s;
    }
    #dashCategoryManager .pill:hover{
      background:var(--pill-bg-hover); color:var(--pill-fg-hover); border-color:var(--pill-border-hover);
    }
    #dashCategoryManager .pill-sm{ padding:.25rem .55rem; font-size:.875rem; cursor:default; }
    .pill-row{ display:flex; flex-wrap:wrap; gap:.5rem .6rem; }
    .pill .chev{ opacity:.7; }

    /* ---------- Small “glass” button in header ---------- */
    .glass-btn{
      display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .6rem; border-radius:.6rem;
      border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.10);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      color:#cfe1ff; line-height:1; box-shadow: 0 1px 0 rgba(0,0,0,.25) inset;
    }
    .glass-btn:hover{ background:rgba(255,255,255,.14); }

    /* ---------- FULL overlay selector (looks like your “Select category…” panel) ---------- */
    #drawer-months-overlay[hidden]{ display:none; }
    #drawer-months-overlay{
      position:fixed; inset:0; z-index:1055; background:rgba(0,0,0,.45);
      backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
      display:flex; align-items:center; justify-content:center; padding:2rem;
    }
    .glass-panel{
      width:min(720px, 92vw); max-height:min(72vh, 640px); overflow:hidden;
      border-radius:1rem; border:1px solid rgba(255,255,255,.16);
      background:linear-gradient(180deg, rgba(16,24,40,.70), rgba(16,24,40,.82));
      box-shadow:0 20px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset;
      backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
      display:flex; flex-direction:column;
    }
    .glass-panel .hdr{
      padding: .9rem 1.1rem; font-weight:600; color:#cfe1ff;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .glass-panel .list{
      overflow:auto; padding:.35rem .35rem 1rem;
    }
    .glass-item{
      display:flex; align-items:center; justify-content:space-between;
      padding:.6rem .9rem; margin:.15rem .25rem; border-radius:.65rem;
      color:#d9e7ff; background:transparent; border:0; width:calc(100% - .5rem);
      text-align:left;
    }
    .glass-item:hover{ background:rgba(255,255,255,.08); }
    .glass-divider{ height:1px; background:rgba(255,255,255,.12); margin:.25rem .5rem; }
    .panel-actions{ display:flex; gap:.5rem; justify-content:flex-end; padding:.7rem .9rem; border-top:1px solid rgba(255,255,255,.12); }
    .btn-ghost{ padding:.45rem .75rem; border-radius:.6rem; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18); color:#e6f0ff; }
    .btn-ghost:hover{ background:rgba(255,255,255,.12); }
  </style>

  <div class="offcanvas-body">
    <!-- Tabs -->
    <div class="drawer-tabbar">
      <a href="#" class="drawer-tab active" data-tab="overview">Overview</a>
      <a href="#" class="drawer-tab" data-tab="keywords">Keywords</a>
      <a href="#" class="drawer-tab" data-tab="actions">Actions</a>
    </div>

    <!-- Children -->
    <div class="mb-2">
      <div class="fw-semibold mb-1">Children:</div>
      <div id="drawer-children" class="pill-row"></div>
    </div>

    <!-- Overview -->
    <div class="drawer-pane" data-pane="overview" style="display:block;">
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead>
            <tr>
              <th class="w-25">Date</th>
              <th>Description</th>
              <th class="text-end w-25">Amount</th>
              <th class="w-25">Cat</th>
            </tr>
          </thead>
          <tbody id="drawer-tx-body">
            <tr><td colspan="4" class="text-muted">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Keywords -->
    <div class="drawer-pane" data-pane="keywords">
      <div class="d-flex align-items-center gap-2 mb-2">
        <input id="kw-add-input" class="form-control form-control-sm" placeholder="Add keyword…" />
        <button id="kw-add-btn" class="btn btn-sm btn-primary">Add</button>
      </div>
      <div id="kw-list" class="d-flex flex-wrap gap-2 small"></div>
    </div>

    <!-- Actions -->
    <div class="drawer-pane" data-pane="actions">
      <div class="small text-muted">Hook <code>[data-action]</code> buttons to <code>runAction(kind)</code> in <code>drawer.js</code>.</div>
    </div>
  </div>
</div>

<!-- FULL overlay (month picker) -->
<div id="drawer-months-overlay" hidden>
  <div class="glass-panel" role="dialog" aria-modal="true" aria-labelledby="drawer-months-title">
    <div class="hdr" id="drawer-months-title">Select month…</div>
    <div class="list" id="drawer-months-overlay-list">
      <!-- items injected by JS: Latest, All, divider, months -->
      <div class="glass-item" data-value="">Latest month</div>
      <div class="glass-item" data-value="all">All months</div>
      <div class="glass-divider"></div>
      <!-- months go here -->
    </div>
    <div class="panel-actions">
      <button type="button" class="btn-ghost" id="drawer-months-cancel">Close</button>
    </div>
  </div>
</div>
